---
marp: true
---

<!-- _class: lead -->
# RAG入門

---
# RAGがなぜできたのか
- LLMは学習時に見た情報、プロンプトとして受け取った情報しか知り得ない
- 学習時に見たことないデータをLLMで扱いたい
- すべての情報を事前にプロンプトに入れることは不可能
- プロンプトの情報をクエリとして検索をし、その結果をプロンプトに追加して上げれば見たことないデータでもLLMがうまく扱えるのではというアイデア

---
# RAGの構成要素
- リトリーバー(検索)
  - ベクトル検索
    - embedding
  - テキスト検索
- LLM

---
# embedding
- テキストをベクトルに変換する仕組み
- 色々な手法がある
  - 単語の構成比率 
  - 機械学習によるテキストのベクトル化
- 現在は機械学習が主流

---
# ベクトル検索
- LLMに読ませたいドキュメントをembeddingでベクトル化する
  - embeddingのtoken数にも上限はあるので、分割する必要がある
- クエリをembeddingでベクトル化し、検索エンジンで近いベクトルを検索する
- ベクトルの次元は多ければ多いほど、精度は上がるが、その分検索のコストも上がる

---
# 一番シンプルなRAGの構成
- 1ドキュメント、1レコードでembeddingする
- ユーザーの入力をembeddingして、クエリとしてドキュメントを検索
- 出力結果をLLMに入力する

---
# なぜうまくいかないのか
- ドキュメントが長すぎる
  - 長過ぎるドキュメントは色々な文脈が混ざりやすい
  - 色々な文脈が混ざった文章は現代技術ではベクトル検索のみでは難しい
    - 数学的に証明されており、現時点で扱えるベクトルでは次元が足りない

---
# チャンキング
- ドキュメントを扱いやすいサイズに分割すること
  - ドキュメントのサイズ
  - どこで区切るのか
- 正解はなくチューニングしていくしかない

---
# ハイブリッド検索
- ベクトル検索とテキスト検索の両方の検索結果を使う
- RAGで使う場合、クエリをどうやって作るのか問題がある
  - テキスト検索ではユーの入力をそのままクエリに入れることはできない

---
# リランキング
- ベクトル検索とテキスト検索の結果をマージすること
- マージのアルゴリズムはRRFで主に使われている
  - テキスト検索でもベクトル検索でもヒットするものは良いドキュメントだよねが発想のアルゴリズム

---
# 検索のアルゴリズムを整えてもなぜうまくいかないのか
- リランキング、ハイブリッド検索を取り入れてもうまくいかないことも多い
- もととなるデータが悪い
  - 古いデータや誤ったデータがあるとコンテキストが汚染される
  - LLMが混乱し、正しく回答できない
- 検索のチューニングと同じくらいデータの整備も重要

---
# まとめ
いい感じに
